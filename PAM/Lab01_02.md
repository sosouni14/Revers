## 실습01-02

실전 악성코드와 멀웨어 분석 Lab01-02

- 패킹이나 난독화가 되어있는가?
- 임포트를 보고 악성코드의 기능을 알아낼 수 있는가?
- 감염된 시스템에서 악성코드를 인식하는 데 어떤 호스트 기반이나 네트워크 기반의 증거를 사용했는가?

---

![Lab2-1](https://raw.githubusercontent.com/sosouni14/image_server/main/image_rev/Lab2-1.PNG)

PEiD 로 파일을 열어보니 **EP Section** 에 UPX1 이라고 나왔다. 패킹 종류이므로 이 실행 파일은 패킹이 된 것을 확인 할 수 있다.

![Lab2-2](https://raw.githubusercontent.com/sosouni14/image_server/main/image_rev/Lab2-2.PNG)

언패킹을 하여 다시 PEiD 을 보았을 때 **EP Section** 에 **.text** 로 나오고 

컴파일 버전도 Microsoft Visual C++ 6.0이 나왔다.

---

![Lab2-3](https://raw.githubusercontent.com/sosouni14/image_server/main/image_rev/Lab2-3.PNG)

패킹 되어 있을 때 임포트 함수들이다.



![Lab2-4](https://raw.githubusercontent.com/sosouni14/image_server/main/image_rev/Lab2-4.PNG)



kernel32.dll, wininet.dll, advapi32.dll 들을 보겠다.

메모리, 파일, 하드웨어 접근과 조작이 가능한 kernel32.dll 과

NTP 같은 프로토콜을 구현한 상위 수준의 네트워크 함수 wininet.dll 그리고

서비스 관리자 나 레지스트리 같은 후가 핵심 윈도우 컴포넌트에 접근 가능한 advapi32.dll 이다.



CreateService : 서비스 개체를 만들고 지정된 서비스 제어 관리자 데이터베이스에 추가한다.

StartServiceCtrlDispatcher : 호출 스레드를 서비스 제어 관리자에 연결한다.

OpenSCManager : 지정된 컴퓨터에서 서비스 제어 관리자에 대한 연결을 설정하고 지정된 서비스 제어 관리자 데이터베이스를 연다.

advapi32.dll 구성 함수들이다.



InternetOpenUrl : 완전한 FTP 또는 HTTP URL로 지정된 리소스를 연다.

InternetOpen : 응용 프로그램의 WinINet 기능 사용을 초기화 한다.

wininet.dll 구성 함수들이다.



전체적인 흐름은 url을 통해 데이터를 받아서 CreateService 함수를 통해 서비스 제어 관리자 데이터 베이스에 추가하게 만드는 것 같다.

---

![Lab2-5](https://raw.githubusercontent.com/sosouni14/image_server/main/image_rev/Lab2-5.PNG)

언패킹화 된 파일을 보면 MalService, Malservice, HGL345,

http://www.malwareanalysisbook.com

Internet Explorer 8.0

이라고 쓰여져 있는게 보인다.



wininet.dll 에 있는 함수 InternetOpenUrl 가  url을 연결시켜 MalService 을 받아게되며 advapi32.dll에 함수들을 통해 데이터베이스를 추가하고 침투할려고 한다고 추측할 수 있다.

